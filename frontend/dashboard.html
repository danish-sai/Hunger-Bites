<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <!-- Description -->
  <meta name="description" content="Food & Restaurant Website" />

  <!-- Author -->
  <meta name="author" content="Danish Saif" />

  <!-- Keywords -->
  <meta name="keywords" content="food, modern, restaurant" />

  <!-- Application Name -->
  <meta name="application-name" content="Hunger Bites" />

  <!-- Favicon -->
  <link rel="shortcut icon" href="img/fav.ico" type="image/png" />
  <style>
    /* Styling for the body and main layout */
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: #333;
      animation: fadeIn 1.5s ease-in-out;
    }

    @keyframes fadeIn {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    .dashboard {
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      padding: 20px;
      width: 90%;
      max-width: 700px;
      animation: scaleUp 0.8s ease-out;
      position: absolute;
    }

    @keyframes scaleUp {
      0% {
        transform: scale(0.9);
      }

      100% {
        transform: scale(1);
      }
    }

    /* Header styling */
    header {
      text-align: center;
      margin-bottom: 20px;
    }

    header h1 {
      font-size: 28px;
      margin: 0;
      color: #4a4a4a;
    }

    /* Styling for statistics section */
    .stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }

    .stat {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.3s ease-in-out, background 0.3s ease;
    }

    .stat:hover {
      transform: translateY(-5px);
      background-color: #e2e8f0;
    }

    .stat h2 {
      margin: 0;
      font-size: 20px;
      color: #555;
    }

    /* Button styling */
    .buttons {
      display: flex;
      justify-content: space-around;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background: #007bff;
      color: #fff;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s ease, transform 0.2s ease;
    }

    button:hover {
      background: #0056b3;
      transform: scale(1.1);
    }

    footer {
      text-align: center;
      margin-top: 20px;
      font-size: 12px;
      color: #666;
    }

    /* Modal styling */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      width: 90%;
      max-width: 700px;
      animation: popIn 0.4s ease-out;
    }

    @keyframes popIn {
      0% {
        transform: scale(0.8);
        opacity: 0;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .product-card {
      display: flex;
      align-items: center;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 15px;
      overflow: hidden;
      transition: transform 0.3s ease;
    }

    .product-card:hover {
      transform: translateY(-5px);
    }

    .product-card img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
      margin-right: 15px;
    }

    .product-card .details h4 {
      margin: 0;
      font-size: 18px;
      color: #333;
    }

    .product-card .details p {
      margin: 5px 0 0;
      font-size: 14px;
      color: #666;
    }

    /* Styling for orders section */
    .orders-section {
      margin-top: 30px;
    }

    .order-card {
      display: flex;
      flex-direction: column;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 15px;
      padding: 15px;
      transition: transform 0.3s ease;
    }

    .order-card:hover {
      transform: translateY(-5px);
    }

    .order-card .order-details {
      margin-bottom: 10px;
    }

    .order-card h4 {
      margin: 0;
      font-size: 18px;
      color: #333;
    }

    .order-card p {
      margin: 5px 0 0;
      font-size: 14px;
      color: #666;
    }

    .order-card .order-buttons {
      display: flex;
      justify-content: space-between;
    }

    .order-card button {
      padding: 8px 15px;
      font-size: 14px;
      border-radius: 5px;
      cursor: pointer;
    }

    .complete-button {
      background-color: #28a745;
      color: #fff;
    }

    .clear-button {
      background-color: #dc3545;
      color: #fff;
    }

    .loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: white;
      /* Light overlay */
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    #content {
      display: block;
      /* Content will show only after the loader disappears */
    }

    /* Positioning for top-right and bottom-right icons */
    .hover-container {
      position: relative;
      width: 50px;
      height: 50px;
      display: inline-block;
      padding-right: 20px;
    }

    /* Icon wrapper */
    .icon-wrapper {
      position: relative;
      transition: transform 0.3s ease;
      /* Smooth movement */
    }

    /* Icon itself */
    .icon {
      width: 100%;
      /* Adjust to fit container */
      transition: transform 0.3s ease;
    }

    /* Hover text */
    .hover-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: #333;
      color: #fff;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
      white-space: nowrap;
      transition: transform 0.3s ease;
    }

    /* Hover animation */
    .icon-wrapper:hover {
      transform: translateX(-5px);
      /* Move icon slightly left */
    }

    .icon-wrapper:hover .hover-text {
      transform: translate(-50%, -50%) scale(1);
      /* Reveal text */
    }
  </style>
</head>

<body>
  <div id="loader" class="loader">
    <img src="img/loader.gif" alt="Loading..." />
  </div>
  <div class="dashboard" id="content">
    <div class="hover-container">
      <div class="icon-wrapper"><a href="index.html">
          <img src="img/home.svg" alt="Home" class="icon">
          <span class="hover-text">Home</span>
        </a>
      </div>
    </div>
    <div class="hover-container">
      <div class="icon-wrapper"><a href="adduser.html">
          <img src="img/add-user.svg" alt="Add User" class="icon">
          <span class="hover-text">Add User</span>
        </a>
      </div>
    </div>
    <header>
      <h1>Restaurant Dashboard</h1>
    </header>
    <div class="stats">
      <div class="stat" onclick="showDetails('product')">
        <h2 id="total-products">Total Products: 0</h2>
      </div>
      <div class="stat" onclick="showDetails('hotdeal')">
        <h2 id="total-hotdeals">Hot Deals: 0</h2>
      </div>
    </div>
    <div class="buttons">
      <button onclick="window.location.href='addproduct.html'">Add Products</button>
      <button onclick="window.location.href='hotdeal.html'">Add Hot Deal</button>
    </div>
    <!-- Orders Section -->
    <div class="orders-section" id="orders-section">
      <h2>Orders</h2>
      <!-- Orders will be populated here dynamically -->
    </div>

    <footer>
      Â© 2024 Restaurant Dashboard. All rights reserved.
    </footer>
    <!-- Floating Icons -->


    <div class="hover-container bottom-right">
      <div class="icon-wrapper"><a href="login.html">
          <img src="img/logout.svg" alt="Log Out" class="icon">
          <span class="hover-text">Log Out</span>
        </a> </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="detailsModal">
    <div class="modal-content">
      <h3 id="modal-title">Details</h3>
      <div id="modal-body" class="details-list"></div>
      <button onclick="closeModal()">Close</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const loader = document.getElementById('loader');
      const content = document.getElementById('content');

      // Show loader for 3 seconds
      setTimeout(() => {
        loader.style.display = 'none'; // Hide loader
        content.style.display = 'block'; // Show dashboard content
      }, 2000); // 2 seconds delay
    });

    document.addEventListener('DOMContentLoaded', () => {
      const modal = document.getElementById('detailsModal');
      const modalTitle = document.getElementById('modal-title');
      const modalBody = document.getElementById('modal-body');
      const ordersSection = document.getElementById('orders-section');

      // Function to fetch data and display counts
      const fetchData = async (url, id, label) => {
        try {
          const response = await fetch(url);
          if (!response.ok) throw new Error(`Failed to fetch data: ${response.status}`);
          const data = await response.json();
          document.getElementById(id).textContent = `${label}: ${data.length}`;
          return data;
        } catch (error) {
          console.error(`${label} error:`, error.message);
          document.getElementById(id).textContent = `${label}: Error`;
        }
      };

      // Function to show details in the modal
      window.showDetails = async (type) => {
        modal.style.display = 'flex';
        modalBody.innerHTML = '<p>Loading...</p>';
        let data;

        if (type === 'product') {
          modalTitle.textContent = 'Product Details';
          data = await fetchData('./menu', 'total-products', 'Total Products');
        } else if (type === 'hotdeal') {
          modalTitle.textContent = 'Hot Deal Details';
          data = await fetchData('./hotdeal', 'total-hotdeals', 'Hot Deals');
        }

        if (data && data.length > 0) {
          modalBody.innerHTML = data
            .map((item) => {
              const image = item.image || 'default.jpg'; // Handle undefined image
              const name = item.dishName || 'No Name Available';
              const price = item.price || '0.00';
              return `<div class="product-card">
                        <img src="${image}" alt="Product">
                        <div class="details">
                          <h4>${name}</h4>
                          <p>$${price}</p>
                        </div>
                      </div>`;
            })
            .join('');
        } else {
          modalBody.innerHTML = '<p>No items found</p>';
        }
      };

      // Function to fetch and display orders
      const fetchOrders = async () => {
        try {
          const response = await fetch('./orders');
          if (!response.ok) throw new Error(`Failed to fetch orders: ${response.status}`);
          const orders = await response.json();
          displayOrders(orders);
        } catch (error) {
          console.error('Orders fetch error:', error.message);
        }
      };

      // Function to display orders in the dashboard
      const displayOrders = (orders) => {
        if (orders.length === 0) {
          ordersSection.innerHTML = '<p>No orders found</p>';
          return;
        }

        ordersSection.innerHTML = orders
          .map((order) => {
            const id = order.id || null; // Ensure id is valid or null
            const customerName = order.name || 'Unknown Customer';
            const status = order.status || 'Pending';
            const total = order.totalAmount || '0.00';

            return `
              <div class="order-card" data-order-id="${id || 'N/A'}">
                <div class="order-details">
                  <h4>Order #${id || 'N/A'}</h4>
                  <p>Customer: ${customerName}</p>
                  <p>Status: ${status}</p>
                  <p>Total: $${total}</p>
                </div>
                <div class="order-buttons">
                  <button class="complete-button" ${!id || status === 'Completed' ? 'disabled' : ''}>Complete</button>
                  <button class="clear-button" ${!id ? 'disabled' : ''}>Clear</button>
                  <button class="show-products-button" onclick="showProductsByOrderId(${id})">Show Products</button>
                </div>
              </div>
            `;
          })
          .join('');

        // Reattach listeners after rendering
        document.querySelectorAll('.complete-button').forEach((btn) => btn.addEventListener('click', handleComplete));
        document.querySelectorAll('.clear-button').forEach((btn) => btn.addEventListener('click', handleClear));
      };

      // Function to show products for a specific order
      window.showProductsByOrderId = async (orderId) => {
        modal.style.display = 'flex';
        modalTitle.textContent = 'Products for Order ' + orderId;
        modalBody.innerHTML = '<p>Loading...</p>';

        try {
          console.log('Fetching products for order ID:', orderId);
          const response = await fetch(`/orders/${orderId}/products`);
          console.log('Response status:', response.status);

          if (!response.ok) {
            throw new Error(`Failed to fetch products for order ${orderId}. Status: ${response.status}`);
          }

          const data = await response.json();
          console.log('Fetched data:', data);

          if (data && data.length > 0) {
            modalBody.innerHTML = data.map((product) => `
        <div class="product-card">
          <div class="details">
            <h4>${product.name || 'No Name Available'}</h4>
            <p>Price: $${product.price || '0.00'}</p>
            <p>Quantity: ${product.quantity || 1}</p>
          </div>
        </div>
      `).join('');
          } else {
            modalBody.innerHTML = '<p>No products found for this order.</p>';
          }
        } catch (error) {
          console.error('Error fetching products:', error);
          modalBody.innerHTML = '<p>Failed to load products. Please check the console for errors.</p>';
        }
      };


      // Handle order completion
      const handleComplete = async (event) => {
        const orderCard = event.target.closest('.order-card');
        const orderId = orderCard.dataset.orderId;

        if (!orderId || orderId === 'N/A') {
          console.error('Invalid order ID:', orderId);
          return;
        }

        try {
          const response = await fetch(`/orders/${orderId}/complete`, { method: 'PUT' });
          if (!response.ok) throw new Error(`Failed to complete order. Status: ${response.status}`);
          const orderDetails = orderCard.querySelector('.order-details');
          orderDetails.querySelector('p:nth-child(3)').textContent = 'Status: Completed';
          event.target.disabled = true;
        } catch (error) {
          console.error('Complete error:', error.message);
          console.log(`Error completing the order: ${error.message}`);
        }
      };

      // Handle order clearing (e.g., delete or cancel order)
      const handleClear = async (event) => {
        const orderCard = event.target.closest('.order-card');
        const orderId = orderCard.dataset.orderId;

        if (!orderId || orderId === 'N/A') {
          console.error('Invalid order ID:', orderId);
          return;
        }

        try {
          const response = await fetch(`/orders/${orderId}/clear`, { method: 'DELETE' });
          if (!response.ok) throw new Error(`Failed to clear order. Status: ${response.status}`);
          orderCard.remove();
        } catch (error) {
          console.error('Clear error:', error.message);
          console.log(`Error clearing the order: ${error.message}`);
        }
      };

      // Fetch data on page load
      fetchData('./menu', 'total-products', 'Total Products');
      fetchData('./hotdeal', 'total-hotdeals', 'Hot Deals');
      fetchOrders();
    });

    // Close modal function
    window.closeModal = () => {
      const modal = document.getElementById('detailsModal');
      modal.style.display = 'none'; // Hide the modal
    };
  </script>




</body>

</html>